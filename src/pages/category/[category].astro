---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const CATEGORIES = {
  'ai-automation': { label: 'AI 자동화' },
  'side-project': { label: '사이드 프로젝트' },
  'dev-log': { label: '개발 일지' },
  'social': { label: '소셜링' },
  'tutorial': { label: '튜토리얼' },
} as const;

type CategoryKey = keyof typeof CATEGORIES;

export function getStaticPaths() {
  const cats = ['ai-automation', 'side-project', 'dev-log', 'social', 'tutorial'];
  return cats.map((category) => ({
    params: { category },
  }));
}

const { category } = Astro.params as { category: CategoryKey };
const catInfo = CATEGORIES[category];

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft && post.data.category === category)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title={`${catInfo.label}`} description={`${catInfo.label} 관련 글 모음 — WonderX Blog`}>
  <div class="page-header">
    <h1>{catInfo.label}</h1>
    <p class="page-desc">{posts.length}개의 글</p>
  </div>

  <section class="posts-section">
    {posts.length > 0 ? (
      <div class="posts-grid">
        {posts.map((post) => {
          const slug = post.id.replace(/\.md$/, '');
          const formattedDate = post.data.pubDate.toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
          });
          return (
            <a href={`/blog/${slug}`} class="post-card">
              <div class="post-info">
                <div class="post-info-meta">
                  <time class="post-date" datetime={post.data.pubDate.toISOString()}>
                    {formattedDate}
                  </time>
                </div>
                <h2 class="post-title">{post.data.title}</h2>
                <p class="post-excerpt">{post.data.description}</p>
              </div>
              {post.data.heroImage && (
                <div class="post-thumbnail">
                  <img src={post.data.heroImage} alt={post.data.title} loading="lazy" />
                </div>
              )}
            </a>
          );
        })}
      </div>
    ) : (
      <p style="color: var(--text-secondary); font-size: 0.9rem; padding: 2rem 0;">
        아직 이 카테고리에 작성된 글이 없습니다.
      </p>
    )}
  </section>
</BaseLayout>

<style>
  .page-header {
    padding: 2rem 0 1.5rem;
    border-bottom: 1px solid var(--border-light);
    margin-bottom: 1rem;
  }

  .page-header h1 {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
  }

  .page-desc {
    font-size: 0.9rem;
    color: var(--text-tertiary);
  }
</style>
